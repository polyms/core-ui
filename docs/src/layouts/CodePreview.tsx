import { Tabs } from '@polyms/core'
import { useEffect, useState } from 'react'
import { codeToHtml } from 'shiki'

export function CodePreview({ code, children }: { code: string; children: React.ReactNode }) {
  const [html, setHtml] = useState('')

  useEffect(() => {
    async function highlight() {
      const codeHtml = await codeToHtml(code, { lang: 'tsx', theme: 'nord' })
      setHtml(codeHtml)
    }

    highlight()
  }, [code])

  return (
    <Tabs className='mt-4 w-full overflow-clip rounded-xl border border-neutral-400' defaultValue='preview'>
      <Tabs.List className='bg-slate-50 px-8'>
        <Tabs.Tab value='preview'>
          <svg
            className='me-2 text-primary/70'
            fill='none'
            height='20'
            viewBox='0 0 24 24'
            width='20'
            xmlns='http://www.w3.org/2000/svg'
          >
            <path
              d='M9.77778 21H14.2222C17.3433 21 18.9038 21 20.0248 20.2777C20.51 19.965 20.9267 19.5632 21.251 19.0953C22 18.0143 22 16.5095 22 13.4999C22 10.4903 21.9998 8.9857 21.2508 7.90473C20.9266 7.43676 20.5099 7.03497 20.0246 6.72228C18.9036 6 17.3431 6 14.2221 6H9.77761C6.65659 6 5.09607 6 3.97508 6.72228C3.48979 7.03497 3.07312 7.43676 2.74886 7.90473C2 8.98547 2 10.4896 2 13.4979L2 13.4999C2 16.5095 2 18.0143 2.74902 19.0953C3.07328 19.5632 3.48995 19.965 3.97524 20.2777C5.09624 21 6.65675 21 9.77778 21Z'
              fill='currentColor'
              opacity='0.5'
            ></path>
            <path
              clipRule='evenodd'
              d='M8 4C8 3.44772 8.41328 3 8.92308 3H15.0769C15.5867 3 16 3.44772 16 4C16 4.55228 15.5867 5 15.0769 5H8.92308C8.41328 5 8 4.55228 8 4Z'
              fill='currentColor'
              fillRule='evenodd'
            ></path>
            <path
              clipRule='evenodd'
              d='M17.2779 10.286C17.2779 9.8422 17.651 9.48242 18.1113 9.48242H18.6668C19.1271 9.48242 19.5002 9.8422 19.5002 10.286C19.5002 10.7298 19.1271 11.0896 18.6668 11.0896H18.1113C17.651 11.0896 17.2779 10.7298 17.2779 10.286Z'
              fill='white'
              fillRule='evenodd'
            ></path>
            <path
              clipRule='evenodd'
              d='M7.8335 13.5003C7.8335 11.2813 9.69898 9.48242 12.0002 9.48242C14.3014 9.48242 16.1668 11.2813 16.1668 13.5003C16.1668 15.7194 14.3014 17.5183 12.0002 17.5183C9.69898 17.5183 7.8335 15.7194 7.8335 13.5003ZM9.50016 13.5003C9.50016 12.1689 10.6195 11.0896 12.0002 11.0896C13.3809 11.0896 14.5002 12.1689 14.5002 13.5003C14.5002 14.8318 13.3809 15.9111 12.0002 15.9111C10.6195 15.9111 9.50016 14.8318 9.50016 13.5003Z'
              fill='currentColor'
              fillRule='evenodd'
            ></path>
            <path
              clipRule='evenodd'
              d='M18.1113 9.48242C17.651 9.48242 17.2779 9.8422 17.2779 10.286C17.2779 10.7298 17.651 11.0896 18.1113 11.0896H18.6668C19.1271 11.0896 19.5002 10.7298 19.5002 10.286C19.5002 9.8422 19.1271 9.48242 18.6668 9.48242H18.1113Z'
              fill='currentColor'
              fillRule='evenodd'
            ></path>
          </svg>
          Preview
        </Tabs.Tab>
        <Tabs.Tab value='code'>
          <svg
            className='me-2 text-primary/70'
            fill='none'
            height='20'
            viewBox='0 0 24 24'
            width='20'
            xmlns='http://www.w3.org/2000/svg'
          >
            <path
              d='M16.4425 7.32787C16.7196 7.01999 17.1938 6.99503 17.5017 7.27213L19.2392 8.83587C19.9756 9.49853 20.5864 10.0482 21.0058 10.5468C21.4468 11.071 21.7603 11.6343 21.7603 12.3296C21.7603 13.0249 21.4468 13.5882 21.0058 14.1124C20.5864 14.611 19.9756 15.1607 19.2392 15.8233L17.5017 17.3871C17.1938 17.6642 16.7196 17.6392 16.4425 17.3313C16.1654 17.0234 16.1904 16.5492 16.4983 16.2721L18.1947 14.7453C18.9826 14.0362 19.5138 13.5558 19.8579 13.1468C20.1882 12.7542 20.2603 12.525 20.2603 12.3296C20.2603 12.1342 20.1882 11.905 19.8579 11.5124C19.5138 11.1034 18.9826 10.623 18.1947 9.91389L16.4983 8.38707C16.1904 8.10997 16.1654 7.63576 16.4425 7.32787Z'
              fill='currentColor'
            ></path>
            <path
              d='M7.50178 8.38707C7.80966 8.10997 7.83462 7.63576 7.55752 7.32787C7.28043 7.01999 6.80621 6.99503 6.49833 7.27213L4.76084 8.83587C4.0245 9.49853 3.41369 10.0482 2.99428 10.5468C2.55325 11.071 2.23975 11.6343 2.23975 12.3296C2.23975 13.0249 2.55325 13.5882 2.99428 14.1124C3.41369 14.611 4.02449 15.1607 4.76082 15.8233L6.49833 17.3871C6.80621 17.6642 7.28043 17.6392 7.55752 17.3313C7.83462 17.0234 7.80966 16.5492 7.50178 16.2721L5.80531 14.7453C5.01743 14.0362 4.48623 13.5558 4.14213 13.1468C3.81188 12.7542 3.73975 12.525 3.73975 12.3296C3.73975 12.1342 3.81188 11.905 4.14213 11.5124C4.48623 11.1034 5.01743 10.623 5.80531 9.91389L7.50178 8.38707Z'
              fill='currentColor'
            ></path>
            <path
              d='M14.1816 4.2755C14.5817 4.3827 14.8191 4.79396 14.7119 5.19406L10.7383 20.0238C10.6311 20.4239 10.2198 20.6613 9.81974 20.5541C9.41964 20.4469 9.18221 20.0356 9.28941 19.6355L13.263 4.80583C13.3702 4.40573 13.7815 4.16829 14.1816 4.2755Z'
              fill='currentColor'
              opacity='0.5'
            ></path>
          </svg>
          Code
        </Tabs.Tab>
      </Tabs.List>
      <Tabs.Panel className='flex h-96 items-center justify-center' value='preview'>
        {children}
      </Tabs.Panel>
      <Tabs.Panel
        className='h-96 overflow-auto p-0'
        dangerouslySetInnerHTML={{ __html: html }}
        value='code'
      />
    </Tabs>
  )
}
